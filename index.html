<!-- Force rebuild -->
<!-- GTCI Dashboard with Tabs: Dashboard & PDF Viewer -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GTCI Comparison Dashboard | Brunei Darussalam</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <style>
    :root { --primary-color: #0d47a1; --secondary-color: #1976d2; --accent-color: #42a5f5; --bg-color: #f4f6f8; --card-bg: #ffffff; --text-color: #333; --border-color: #e0e0e0; }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; }
    body { background-color: var(--bg-color); color: var(--text-color); min-height: 100vh; display: flex; flex-direction: column; }
    header { background-color: var(--primary-color); color: white; padding: 0.8rem 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
    header h1 { font-size: 1.5rem; font-weight: 600; margin: 0; }
    .tab-bar { display: flex; gap: 0.5rem; }
    .tab-btn { background: rgba(255,255,255,0.15); color: white; border: none; padding: 0.6rem 1rem; cursor: pointer; font-size: 0.95rem; border-radius: 4px 4px 0 0; transition: all 0.2s; }
    .tab-btn:hover { background: rgba(255,255,255,0.25); }
    .tab-btn.active { background: white; color: var(--primary-color); font-weight: 600; }
    .container { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 400px; background: var(--card-bg); border-right: 1px solid var(--border-color); overflow-y: auto; padding: 1.5rem; }
    .sidebar-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-color); }
    .content-area { flex: 1; overflow-y: auto; padding: 2rem; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .chart-container { background: var(--card-bg); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); min-height: 400px; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { padding: 0.8rem; text-align: left; border-bottom: 1px solid var(--border-color); }
    th { background: #f5f5f5; font-weight: 600; }
    .pdf-controls { background: white; padding: 1rem; border-bottom: 1px solid var(--border-color); display: flex; gap: 1rem; justify-content: center; align-items: center; margin-bottom: 1rem; border-radius: 4px; }
    .pdf-viewer { background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; overflow: auto; min-height: 600px; }
    #pdfCanvas { max-width: 100%; max-height: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    button { padding: 0.6rem 1.2rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; background: var(--secondary-color); color: white; transition: all 0.2s; }
    button:hover { background: var(--primary-color); }
    .rank-display { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem; display: flex; justify-content: space-around; }
    .rank-card { text-align: center; }
    .rank-card .number { font-size: 2.5rem; font-weight: bold; }
    .rank-card .label { font-size: 0.9rem; opacity: 0.9; }
  </style>
</head>
<body>
  <header>
    <h1>üöÄ GTCI Dashboard | Brunei Darussalam</h1>
    <div class="tab-bar">
      <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
      <button class="tab-btn" onclick="switchTab('pdf')">üìÑ GTCI Report (PDF)</button>
    </div>
  </header>

  <div class="container">
    <div class="sidebar">
      <div class="sidebar-title">üìã Controls</div>
      <p style="font-size:0.9rem; color:#666; margin-bottom:1rem;">Use the tabs above to switch between Dashboard view and PDF report.</p>
      <div style="background:#e3f2fd; padding:1rem; border-radius:4px;">
        <strong>Global Rank:</strong><br>2023: <span id="rank23">41</span> ‚Üí 2025: <span id="rank25">43</span>
      </div>
    </div>

    <div class="content-area">
      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-content active">
        <div class="rank-display">
          <div class="rank-card"><div class="number" id="displayRank23">41</div><div class="label">2023 Rank</div></div>
          <div class="rank-card"><div class="number" id="displayRank25">43</div><div class="label">2025 Rank</div></div>
          <div class="rank-card"><div class="number" id="scoreDisplay23">51.74</div><div class="label">2023 Score</div></div>
          <div class="rank-card"><div class="number" id="scoreDisplay25">51.48</div><div class="label">2025 Score</div></div>
        </div>
        
        <div class="chart-container">
          <h3>Score Comparison by Pillar</h3>
          <canvas id="pillarChart"></canvas>
        </div>

        <div class="chart-container">
          <h3>Key Metrics</h3>
          <table>
            <tr><th>Metric</th><th>2023</th><th>2025</th><th>Change</th></tr>
            <tr><td>Global Rank</td><td>41</td><td>43</td><td>-2</td></tr>
            <tr><td>Global Score</td><td>51.74</td><td>51.48</td><td>-0.26</td></tr>
            <tr><td>Improved Indicators</td><td colspan="2">27</td><td>‚Üë</td></tr>
            <tr><td>Declined Indicators</td><td colspan="2">35</td><td>‚Üì</td></tr>
            <tr><td>Missing/Zero Data</td><td colspan="2">15</td><td>‚ö†</td></tr>
          </table>
        </div>
      </div>

      <!-- PDF Viewer Tab -->
      <div id="pdf" class="tab-content">
        <div class="pdf-controls">
          <button onclick="prevPage()">‚Üê Previous</button>
          <span id="pageInfo" style="font-weight:600; min-width:120px; text-align:center;">Page 1 of 1</span>
          <button onclick="nextPage()">Next ‚Üí</button>
          <button onclick="downloadPDF()">‚¨á Download</button>
        </div>
        <div class="pdf-viewer">
          <canvas id="pdfCanvas"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'dashboard';
    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    let pillarChart = null;

    // Tab Switching
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');
      currentTab = tab;
      
      if (tab === 'pdf' && !pdfDoc) {
        setTimeout(() => loadPDF(), 200);
      }
      if (tab === 'dashboard' && !pillarChart) {
        setTimeout(() => renderChart(), 300);
      }
    }

    // Chart Rendering
    function renderChart() {
      const ctx = document.getElementById('pillarChart');
      if (!ctx || pillarChart) return;
      
      pillarChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Enable', 'Attract', 'Grow', 'Retain', 'Voc Skills', 'Global Kn.'],
          datasets: [
            { label: '2023', data: [49.43, 53.71, 44.35, 65.15, 63.32, 34.47], backgroundColor: '#cfd8dc' },
            { label: '2025', data: [56.30, 56.08, 39.88, 65.49, 62.18, 28.98], backgroundColor: '#90caf9' }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }

    // PDF Functions
    function loadPDF() {
      const pdfPath = 'https://raw.githubusercontent.com/mpb2035/bn-gtci-dashboard/test-branch/2025%20Brunei%20GTCI%20Ranking%20(1).pdf';
      const pdfjsWorker = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;
      
      pdfjsLib.getDocument(pdfPath).promise.then(pdf => {
        pdfDoc = pdf;
        document.getElementById('pageInfo').textContent = 'Page 1 of ' + pdf.numPages;
        renderPage(1);
      }).catch(err => {
        document.querySelector('.pdf-viewer').innerHTML = '<p style="color:#c62828; padding:2rem;">‚ö† PDF file not found or cannot be loaded. Ensure the file is in the repository.</p>';
      });
    }

    function renderPage(num) {
      if (!pdfDoc || pageRendering) return;
      pageRendering = true;
      pdfDoc.getPage(num).then(page => {
        const canvas = document.getElementById('pdfCanvas');
        const ctx = canvas.getContext('2d');
        const viewport = page.getViewport({scale: 1.5});
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        page.render({canvasContext: ctx, viewport}).promise.then(() => {
          pageRendering = false;
          if (pageNumPending !== null) { renderPage(pageNumPending); pageNumPending = null; }
        });
      });
      document.getElementById('pageInfo').textContent = 'Page ' + num + ' of ' + pdfDoc.numPages;
    }

    function nextPage() { if (pageNum < pdfDoc.numPages) { pageNum++; pageRendering ? pageNumPending = pageNum : renderPage(pageNum); } }
    function prevPage() { if (pageNum > 1) { pageNum--; pageRendering ? pageNumPending = pageNum : renderPage(pageNum); } }
    function downloadPDF() {
      const link = document.createElement('a');
      link.href = 'https://raw.githubusercontent.com/mpb2035/bn-gtci-dashboard/test-branch/2025%20Brunei%20GTCI%20Ranking%20(1).pdf';
      link.download = 'GTCI_2025_Brunei.pdf';
      link.click();
    }

    // Initialize
    window.addEventListener('load', () => {
      renderChart();
    });
  </script>
</body>
</html>
